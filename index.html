<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Machote Urgencias ‚Äî Nota de Evoluci√≥n</title>
  <style>
    :root{
      --bg:#0b1220;
      --muted:#9aa4b2;
      --text:#e7edf6;
      --line:rgba(255,255,255,.08);
      --accent:#77d7ff;
      --accent2:#76f7c6;
      --warn:#ffcf5a;
      --shadow:0 12px 30px rgba(0,0,0,.35);
      --radius:18px;
      --radius2:14px;
      --pad:18px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      background: radial-gradient(1200px 800px at 20% -10%, rgba(119,215,255,.18), transparent 60%),
                  radial-gradient(1000px 700px at 90% 10%, rgba(118,247,198,.14), transparent 55%),
                  linear-gradient(180deg, #070b14, #0b1220 35%, #070b14);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:20;
      background:rgba(7,11,20,.8);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1200px;margin:0 auto;padding:14px 16px;}
    .topbar{display:flex; gap:14px; align-items:center; justify-content:space-between;}
    .brand{display:flex; flex-direction:column; gap:2px;}
    .brand h1{margin:0; font-size:16px; letter-spacing:.2px;}
    .brand p{margin:0;color:var(--muted);font-size:12px}
    .actions{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-end;}
    .pill{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      color:var(--text);
      padding:9px 12px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      transition: transform .05s ease, border-color .2s ease, background .2s ease;
    }
    .pill:hover{border-color:rgba(127,211,255,.45)}
    .pill:active{transform: translateY(1px)}
    .pill.primary{
      border-color:rgba(118,247,198,.35);
      box-shadow:0 0 0 1px rgba(118,247,198,.08) inset;
    }
    .pill.danger{border-color:rgba(255,207,90,.35);}

    main{max-width:1200px;margin:0 auto;padding:18px 16px 44px;}
    .grid{display:grid; gap:14px;}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .head{
      display:flex; align-items:flex-start; justify-content:space-between;
      padding:16px var(--pad);
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(127,211,255,.08), transparent);
    }
    .titlebox{display:flex;flex-direction:column;gap:4px}
    .titlebox h2{margin:0; font-size:16px;}
    .titlebox .sub{margin:0; font-size:12px; color:var(--muted);}
    .head .right{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
    .btn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--text);
      padding:9px 12px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      transition: border-color .2s ease, background .2s ease, transform .05s ease;
      display:inline-flex; align-items:center; gap:8px;
      user-select:none;
    }
    .btn:hover{border-color:rgba(127,211,255,.45)}
    .btn:active{transform: translateY(1px)}
    .btn.good{
      border-color:rgba(118,247,198,.35);
      background: rgba(118,247,198,.08);
    }
    .btn.copy{
      border-color:rgba(127,211,255,.40);
      background: rgba(127,211,255,.10);
      color:#eaf7ff;
    }
    .content{
      padding:16px var(--pad);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width: 980px){ .content{grid-template-columns: 1fr;} }
    .formgrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-content:start;
    }
    @media (max-width: 560px){ .formgrid{grid-template-columns: 1fr;} }
    label{
      font-size:12px;
      color:var(--muted);
      display:block;
      margin:0 0 6px 2px;
    }
    select, input, textarea{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(5,8,15,.55);
      color:var(--text);
      outline:none;
      transition: border-color .2s ease, box-shadow .2s ease;
      font-size:13px;
    }
    textarea{min-height:110px; resize:vertical}
    select:focus, input:focus, textarea:focus{
      border-color:rgba(127,211,255,.5);
      box-shadow: 0 0 0 3px rgba(127,211,255,.12);
    }
    .span2{grid-column: span 2}
    @media (max-width:560px){.span2{grid-column:span 1}}
    .finalbox{
      border:1px solid rgba(255,255,255,.10);
      border-radius:var(--radius2);
      background: rgba(255,255,255,.03);
      padding:14px 14px 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height: 220px;
    }
    .finaltop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .finaltop .small{font-size:12px;color:var(--muted);}
    pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12.5px;
      line-height:1.35;
      color:#ecf4ff;
    }
    .toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background: rgba(12,18,34,.92);
      border:1px solid rgba(127,211,255,.25);
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      box-shadow: var(--shadow);
      opacity:0;
      pointer-events:none;
      transition: opacity .22s ease, transform .22s ease;
      z-index:40;
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-6px);}
    .divider{height:1px;background:var(--line); margin:8px 0 2px;}
    .hint{font-size:12px;color:var(--muted); margin-top:2px;}
    .toggleRow{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      padding:10px 12px; border:1px solid rgba(255,255,255,.10);
      border-radius:12px; background:rgba(5,8,15,.35)
    }
    .toggleRow label{margin:0; color:var(--text); font-size:13px; display:flex; gap:8px; align-items:center}
    .badge{
      font-size:11px; color:var(--muted);
      border:1px solid rgba(255,255,255,.10);
      padding:2px 8px; border-radius:999px;
      background:rgba(255,255,255,.03);
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <h1>Machote de Urgencias ‚Äî Nota de Evoluci√≥n</h1>
        <p>Mismos espacios del formato. Copiado por secci√≥n + nota completa.</p>
      </div>
      <div class="actions">
        <button class="pill primary" id="btnAllNormal">‚úÖ Todo normal (Nota)</button>
        <button class="pill danger" id="btnAllClear">üßπ Limpiar todo</button>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="grid">

    <!-- SECCI√ìN: ENCABEZADO + SV + NARRATIVA -->
    <section class="card" id="cardCore">
      <div class="head">
        <div class="titlebox">
          <h2>Nota de evoluci√≥n ‚Äî Urgencias</h2>
          <p class="sub">Encabezado, SV, narrativa, estudios solicitados y comunicaci√≥n.</p>
        </div>
        <div class="right">
          <button class="btn good" id="coreNormal">Normal</button>
          <button class="btn" id="coreClear">Limpiar</button>
        </div>
      </div>

      <div class="content">
        <div class="formgrid">
          <div>
            <label>Fecha (formato libre)</label>
            <input id="n_date" placeholder="Ej. 30.12.25" />
          </div>
          <div>
            <label>Servicio que valora</label>
            <input id="n_service" placeholder="Ej. Urgencias / Medicina Interna / Pediatr√≠a..." />
          </div>

          <div class="span2">
            <label>Signos vitales</label>
            <div class="formgrid">
              <div>
                <label>TA (mmHg)</label>
                <input id="sv_ta" placeholder="Ej. 120/80" />
              </div>
              <div>
                <label>FC (lpm)</label>
                <input id="sv_fc" placeholder="Ej. 88" />
              </div>
              <div>
                <label>FR (rpm)</label>
                <input id="sv_fr" placeholder="Ej. 18" />
              </div>
              <div>
                <label>Temperatura (¬∞C)</label>
                <input id="sv_temp" placeholder="Ej. 36.7" />
              </div>
              <div class="span2">
                <label>SpO‚ÇÇ (%)</label>
                <input id="sv_spo2" placeholder="Ej. 96" />
              </div>
            </div>
          </div>

          <div class="span2">
            <label>Opcionales (activar)</label>
            <div class="toggleRow">
              <label><input type="checkbox" id="opt_ef" checked> Incluir ‚Äúanamnesis y exploraci√≥n f√≠sica completa‚Äù</label>
              <label><input type="checkbox" id="opt_iv"> Canalizaci√≥n / soluciones</label>
              <label><input type="checkbox" id="opt_med"> Medicaci√≥n administrada</label>
            </div>
          </div>

          <div class="span2">
            <label>Canalizaci√≥n (solo si activas)</label>
            <div class="formgrid">
              <div>
                <label>Soluci√≥n</label>
                <input id="iv_sol" placeholder="Ej. Sol. Hartmann / SSN 0.9%..." />
              </div>
              <div>
                <label>Velocidad (cc/h)</label>
                <input id="iv_rate" placeholder="Ej. 100" />
              </div>
            </div>
          </div>

          <div class="span2">
            <label>Medicamento administrado (solo si activas)</label>
            <div class="formgrid">
              <div>
                <label>F√°rmaco</label>
                <input id="med_name" placeholder="Ej. Paracetamol 1 g IV" />
              </div>
              <div>
                <label>Para manejo de</label>
                <input id="med_for" placeholder="Ej. dolor, fiebre, broncoespasmo..." />
              </div>
            </div>
          </div>

          <div class="span2">
            <label>Estudios solicitados (texto libre)</label>
            <div class="formgrid">
              <div>
                <label>Laboratorio (***** )</label>
                <input id="req_labs" placeholder="Ej. BH, QS, EGO, PCR..." />
              </div>
              <div>
                <label>Gabinete (**** )</label>
                <input id="req_img" placeholder="Ej. Rx t√≥rax, USG, TAC..." />
              </div>
            </div>
          </div>

          <div class="span2">
            <label>Comunicaci√≥n con m√©dico(a)</label>
            <div class="formgrid">
              <div>
                <label>Nombre del m√©dico</label>
                <input id="doc_name" placeholder="Ej. Dr. Juan P√©rez" />
              </div>
              <div>
                <label>Rol / servicio</label>
                <input id="doc_role" placeholder="Ej. M√©dico adscrito / Cirujano / Pediatr√≠a..." />
              </div>
              <div class="span2">
                <label>Decisi√≥n / indicaciones</label>
                <input id="doc_decision" placeholder="Ej. decide ingreso a hospitalizaci√≥n / egreso con manejo..." />
              </div>
            </div>
          </div>

          <div class="span2">
            <label>Egreso</label>
            <select id="dispo">
              <option value="egreso">Egresa del servicio de urgencias estable, sin eventualidades.</option>
              <option value="ingreso">Se decide ingreso a hospitalizaci√≥n.</option>
              <option value="obs">Se decide estancia en observaci√≥n.</option>
              <option value="ref">Se decide referencia/traslado a otra unidad.</option>
              <option value="custom">Personalizar (escribir abajo)</option>
            </select>
          </div>
          <div class="span2">
            <label>Texto de disposici√≥n (si personalizar)</label>
            <input id="dispo_custom" placeholder="Ej. Traslado a UCI, ingreso a piso, etc." />
          </div>

          <div class="span2">
            <label>Notas adicionales (opcional)</label>
            <textarea id="n_extra" placeholder="Si quieres agregar algo al p√°rrafo (breve)."></textarea>
          </div>
        </div>

        <div class="finalbox">
          <div class="finaltop">
            <div class="small">Texto final ‚Äî Nota (encabezado + narrativa)</div>
            <button class="btn copy" data-copy="coreText">Copiar</button>
          </div>
          <div class="divider"></div>
          <pre id="coreText"></pre>
          <div class="hint">Respeta el estilo y los ‚Äúespacios‚Äù del machote. Opcionales se agregan solo si se activan.</div>
        </div>
      </div>
    </section>

    <!-- SECCI√ìN: PARACL√çNICOS (GASOMETR√çA) -->
    <section class="card" id="cardGas">
      <div class="head">
        <div class="titlebox">
          <h2>Estudios paracl√≠nicos ‚Äî Gasometr√≠a</h2>
          <p class="sub">Completa valores o deja vac√≠o (no se imprimen si est√°n vac√≠os).</p>
        </div>
        <div class="right">
          <span class="badge">Opcional</span>
          <button class="btn good" id="gasNormal">Normal</button>
          <button class="btn" id="gasClear">Limpiar</button>
        </div>
      </div>

      <div class="content">
        <div class="formgrid">
          <div><label>pH</label><input id="g_ph" placeholder="Ej. 7.40" /></div>
          <div><label>PCO‚ÇÇ</label><input id="g_pco2" placeholder="Ej. 40" /></div>
          <div><label>PO‚ÇÇ</label><input id="g_po2" placeholder="Ej. 90" /></div>
          <div><label>Hb</label><input id="g_hb" placeholder="Ej. 14" /></div>
          <div><label>sO‚ÇÇ</label><input id="g_so2" placeholder="Ej. 97" /></div>
          <div><label>AG</label><input id="g_ag" placeholder="Ej. 12" /></div>
          <div><label>EB</label><input id="g_eb" placeholder="Ej. 0" /></div>
          <div><label>HCO‚ÇÉ</label><input id="g_hco3" placeholder="Ej. 24" /></div>
          <div><label>K</label><input id="g_k" placeholder="Ej. 4.0" /></div>
          <div><label>Na</label><input id="g_na" placeholder="Ej. 140" /></div>
          <div><label>Ca</label><input id="g_ca" placeholder="Ej. 1.15" /></div>
          <div><label>Cl</label><input id="g_cl" placeholder="Ej. 102" /></div>
          <div><label>Glu</label><input id="g_glu" placeholder="Ej. 95" /></div>
          <div><label>Lac</label><input id="g_lac" placeholder="Ej. 1.2" /></div>
          <div><label>p50</label><input id="g_p50" placeholder="Ej. 26" /></div>
          <div class="span2">
            <label>Hallazgos (texto)</label>
            <input id="g_find" placeholder="Ej. sin alteraciones / acidosis metab√≥lica..." />
          </div>

          <div class="span2">
            <label>Incluir secci√≥n en la nota completa</label>
            <div class="toggleRow">
              <label><input type="checkbox" id="incl_gas"> Incluir gasometr√≠a en la nota</label>
            </div>
          </div>
        </div>

        <div class="finalbox">
          <div class="finaltop">
            <div class="small">Texto final ‚Äî Gasometr√≠a</div>
            <button class="btn copy" data-copy="gasText">Copiar</button>
          </div>
          <div class="divider"></div>
          <pre id="gasText"></pre>
        </div>
      </div>
    </section>

    <!-- SECCI√ìN: ECG -->
    <section class="card" id="cardECG">
      <div class="head">
        <div class="titlebox">
          <h2>Electrocardiograma 12 derivaciones</h2>
          <p class="sub">Opcional. Completa tiempos/FC/hallazgos.</p>
        </div>
        <div class="right">
          <span class="badge">Opcional</span>
          <button class="btn good" id="ecgNormal">Normal</button>
          <button class="btn" id="ecgClear">Limpiar</button>
        </div>
      </div>

      <div class="content">
        <div class="formgrid">
          <div><label>Ritmo</label><input id="e_ritmo" placeholder="Ej. sinusal" /></div>
          <div><label>FC (lpm)</label><input id="e_fc" placeholder="Ej. 80" /></div>
          <div><label>P (ms)</label><input id="e_p" placeholder="Ej. 100" /></div>
          <div><label>PR (ms)</label><input id="e_pr" placeholder="Ej. 160" /></div>
          <div><label>QRS (ms)</label><input id="e_qrs" placeholder="Ej. 90" /></div>
          <div><label>QTm (ms)</label><input id="e_qtm" placeholder="Ej. 380" /></div>
          <div><label>QTm (Bazett) (ms)</label><input id="e_qtc" placeholder="Ej. 410" /></div>
          <div><label>Eje</label><input id="e_eje" placeholder="Ej. normal" /></div>
          <div><label>Transici√≥n</label><input id="e_trans" placeholder="Ej. V3" /></div>
          <div><label>Posici√≥n</label><input id="e_pos" placeholder="Ej. intermedia" /></div>
          <div class="span2"><label>Hallazgos</label><input id="e_find" placeholder="Ej. sin cambios isqu√©micos agudos..." /></div>

          <div class="span2">
            <label>Incluir secci√≥n en la nota completa</label>
            <div class="toggleRow">
              <label><input type="checkbox" id="incl_ecg"> Incluir ECG en la nota</label>
            </div>
          </div>
        </div>

        <div class="finalbox">
          <div class="finaltop">
            <div class="small">Texto final ‚Äî ECG</div>
            <button class="btn copy" data-copy="ecgText">Copiar</button>
          </div>
          <div class="divider"></div>
          <pre id="ecgText"></pre>
        </div>
      </div>
    </section>

    <!-- SECCI√ìN: RX T√ìRAX -->
    <section class="card" id="cardCXR">
      <div class="head">
        <div class="titlebox">
          <h2>Radiograf√≠a de t√≥rax PA y lateral</h2>
          <p class="sub">Normal por default o personaliza hallazgos.</p>
        </div>
        <div class="right">
          <span class="badge">Opcional</span>
          <button class="btn good" id="cxrNormal">Normal</button>
          <button class="btn" id="cxrClear">Limpiar</button>
        </div>
      </div>

      <div class="content">
        <div class="formgrid">
          <div class="span2">
            <label>Modo</label>
            <select id="cxr_mode">
              <option value="normal">Normal (texto est√°ndar)</option>
              <option value="custom">Insertar/editar hallazgos</option>
            </select>
          </div>
          <div class="span2">
            <label>Hallazgos (si ‚ÄúInsertar‚Äù)</label>
            <textarea id="cxr_custom" placeholder="Ej. infiltrado intersticial bibasal, cardiomegalia, derrame..."></textarea>
          </div>

          <div class="span2">
            <label>Incluir secci√≥n en la nota completa</label>
            <div class="toggleRow">
              <label><input type="checkbox" id="incl_cxr"> Incluir radiograf√≠a en la nota</label>
            </div>
          </div>
        </div>

        <div class="finalbox">
          <div class="finaltop">
            <div class="small">Texto final ‚Äî Radiograf√≠a</div>
            <button class="btn copy" data-copy="cxrText">Copiar</button>
          </div>
          <div class="divider"></div>
          <pre id="cxrText"></pre>
        </div>
      </div>
    </section>

    <!-- SECCI√ìN: NOTA COMPLETA -->
    <section class="card" id="cardAll">
      <div class="head">
        <div class="titlebox">
          <h2>Nota completa (para copiar y pegar)</h2>
          <p class="sub">Incluye paracl√≠nicos solo si activas ‚ÄúIncluir ‚Ä¶ en la nota‚Äù.</p>
        </div>
        <div class="right">
          <button class="btn copy" data-copy="allText">Copiar todo</button>
        </div>
      </div>

      <div class="content">
        <div class="finalbox" style="grid-column:1/-1; min-height:260px">
          <div class="finaltop">
            <div class="small">Texto final ‚Äî Nota completa</div>
            <button class="btn copy" data-copy="allText">Copiar</button>
          </div>
          <div class="divider"></div>
          <pre id="allText"></pre>
          <div class="hint">Al final queda el recordatorio: **INSERTAR NOMBRE DE M√âDICOS.</div>
        </div>
      </div>
    </section>

  </div>
</main>

<div class="toast" id="toast">Copiado ‚úÖ</div>

<script>
  const $ = (id)=>document.getElementById(id);

  const toast = (msg="Copiado ‚úÖ")=>{
    const t = $("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"), 900);
  };

  const copyText = async (text)=>{
    try{
      await navigator.clipboard.writeText(text);
      toast();
    }catch(e){
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      toast("Copiado (fallback) ‚úÖ");
    }
  };

  const joinClean = (parts, sep=" ")=>{
    return parts.map(x=>String(x||"").trim()).filter(Boolean).join(sep);
  };

  const fmtSV = ()=>{
    const ta = $("sv_ta").value.trim();
    const fc = $("sv_fc").value.trim();
    const fr = $("sv_fr").value.trim();
    const te = $("sv_temp").value.trim();
    const sp = $("sv_spo2").value.trim();
    return `Signos Vitales: TA ${ta} mmHg  |  FC ${fc} lpm |  FR ${fr} rpm  |  Temperatura ${te} ¬∞C  |  SpO2 ${sp} %`;
  };

  function dispoText(){
    const v = $("dispo").value;
    if(v==="egreso") return "Egresa del servicio de urgencias estable, sin eventualidades.";
    if(v==="ingreso") return "Se decide ingreso a hospitalizaci√≥n.";
    if(v==="obs") return "Se decide estancia en observaci√≥n.";
    if(v==="ref") return "Se decide referencia/traslado a otra unidad.";
    return $("dispo_custom").value.trim() || "Se decide conducta a determinar.";
  }

  // ---------- CORE ----------
  function buildCore(){
    const date = $("n_date").value.trim() || "(insertar fecha)";
    const service = $("n_service").value.trim() || "*insertar*";

    const line1 = "NOTA DE EVOLUCI√ìN URGENCIAS";
    const line2 = `${date}`;

    const sv = fmtSV();

    const includeEF = $("opt_ef").checked;
    const includeIV = $("opt_iv").checked;
    const includeMed = $("opt_med").checked;

    const efText = includeEF ? "Se realizan anamnesis y exploraci√≥n f√≠sica completa." : "";

    const ivSol = $("iv_sol").value.trim();
    const ivRate = $("iv_rate").value.trim();
    const ivText = includeIV
      ? `Se canaliza con soluci√≥n ${ivSol || "+"} a una velocidad de infusi√≥n de ${ivRate || "+"} cc/h.`
      : "";

    const medName = $("med_name").value.trim();
    const medFor = $("med_for").value.trim();
    const medText = includeMed
      ? `Se administra ${medName || "+"} para manejo de ${medFor || "+"}.`
      : "";

    const reqLabs = $("req_labs").value.trim() || "(*****)";
    const reqImg  = $("req_img").value.trim()  || "(****)";
    const reqText = `Se solicitan estudios de laboratorio ${reqLabs} y de gabinete ${reqImg} como complemento diagn√≥stico.`;

    const docName = $("doc_name").value.trim() || "Dr. ****";
    const docRole = $("doc_role").value.trim() || "(M√©dico ***)";
    const docDecision = $("doc_decision").value.trim() || "+";
    const comm = `Nos comunicamos con el ${docName}, ${docRole}, quien enterado del caso dicta indicaciones y decide ${docDecision}.`;

    const extra = $("n_extra").value.trim();

    const core =
`${line1}
${line2}
${sv}

Paciente valorado por el servicio de ${service}. ${joinClean([efText, ivText, medText], " ")}
${reqText}
${extra ? extra : ""}

${comm}
${dispoText()}
**INSERTAR NOMBRE DE MEDICOS`;

    return core.replace(/\n{3,}/g,"\n\n").trim();
  }

  function coreNormal(){
    const d = new Date();
    const dd = String(d.getDate()).padStart(2,"0");
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const yy = String(d.getFullYear()).slice(-2);
    $("n_date").value = `${dd}.${mm}.${yy}`;

    $("n_service").value = "Urgencias";
    $("sv_ta").value = "120/80";
    $("sv_fc").value = "80";
    $("sv_fr").value = "18";
    $("sv_temp").value = "36.7";
    $("sv_spo2").value = "96";

    $("opt_ef").checked = true;
    $("opt_iv").checked = false;
    $("opt_med").checked = false;

    $("iv_sol").value = "";
    $("iv_rate").value = "";

    $("med_name").value = "";
    $("med_for").value = "";

    $("req_labs").value = "BH, QS, EGO";
    $("req_img").value  = "Radiograf√≠a de t√≥rax";
    $("doc_name").value = "";
    $("doc_role").value = "";
    $("doc_decision").value = "";
    $("dispo").value = "egreso";
    $("dispo_custom").value = "";
    $("n_extra").value = "";
  }

  function coreClear(){
    ["n_date","n_service","sv_ta","sv_fc","sv_fr","sv_temp","sv_spo2",
     "iv_sol","iv_rate","med_name","med_for","req_labs","req_img",
     "doc_name","doc_role","doc_decision","dispo_custom","n_extra"].forEach(id=>$(id).value="");
    $("opt_ef").checked = true;
    $("opt_iv").checked = false;
    $("opt_med").checked = false;
    $("dispo").value="egreso";
  }

  // ---------- GAS ----------
  function buildGas(){
    const fields = [
      ["pH", $("g_ph").value.trim()],
      ["PCO2", $("g_pco2").value.trim()],
      ["PO2", $("g_po2").value.trim()],
      ["Hb", $("g_hb").value.trim()],
      ["sO", $("g_so2").value.trim()],
      ["AG", $("g_ag").value.trim()],
      ["EB", $("g_eb").value.trim()],
      ["HCO3", $("g_hco3").value.trim()],
      ["K", $("g_k").value.trim()],
      ["Na", $("g_na").value.trim()],
      ["Ca", $("g_ca").value.trim()],
      ["Cl", $("g_cl").value.trim()],
      ["Glu", $("g_glu").value.trim()],
      ["Lac", $("g_lac").value.trim()],
      ["p50", $("g_p50").value.trim()],
    ];

    const kv = fields
      .filter(([,v])=>v)
      .map(([k,v])=>`${k}: ${v}`)
      .join("  ");

    const hall = $("g_find").value.trim();
    const hallTxt = hall ? `  Hallazgos: ${hall}` : "";

    // Mantener la ‚Äúplantilla‚Äù de espacios incluso vac√≠os:
    const template =
`ESTUDIOS PARACL√çNICOS:
pH: ${$("g_ph").value.trim() || ""}  PCO2: ${$("g_pco2").value.trim() || ""}  PO2: ${$("g_po2").value.trim() || ""}  Hb: ${$("g_hb").value.trim() || ""}  sO: ${$("g_so2").value.trim() || ""}  AG: ${$("g_ag").value.trim() || ""}  EB: ${$("g_eb").value.trim() || ""}  HCO3: ${$("g_hco3").value.trim() || ""}  K: ${$("g_k").value.trim() || ""}  Na: ${$("g_na").value.trim() || ""}  Ca: ${$("g_ca").value.trim() || ""}  Cl: ${$("g_cl").value.trim() || ""}  Glu: ${$("g_glu").value.trim() || ""}  Lac: ${$("g_lac").value.trim() || ""}
p50: ${$("g_p50").value.trim() || ""}  Hallazgos: ${hall || ""}`;

    // Si todo est√° vac√≠o, mostrar una l√≠nea m√≠nima √∫til:
    const any = fields.some(([,v])=>v) || hall;
    return any ? template : "ESTUDIOS PARACL√çNICOS: ‚Äî";
  }

  function gasNormal(){
    // ‚ÄúNormal‚Äù aqu√≠ = dejarlo vac√≠o pero listo para usar
    ["g_ph","g_pco2","g_po2","g_hb","g_so2","g_ag","g_eb","g_hco3","g_k","g_na","g_ca","g_cl","g_glu","g_lac","g_p50","g_find"].forEach(id=>$(id).value="");
    $("incl_gas").checked = false;
  }
  function gasClear(){ gasNormal(); }

  // ---------- ECG ----------
  function buildECG(){
    const any = ["e_ritmo","e_fc","e_p","e_pr","e_qrs","e_qtm","e_qtc","e_eje","e_trans","e_pos","e_find"]
      .some(id=>$(id).value.trim());

    if(!any) return "Electrocardiograma 12 derivaciones: ‚Äî";

    return `Electrocardiograma 12 derivaciones: Ritmo: ${$("e_ritmo").value.trim()}  FC: ${$("e_fc").value.trim()} lpm  P: ${$("e_p").value.trim()} ms  PR: ${$("e_pr").value.trim()} ms  QRS: ${$("e_qrs").value.trim()} ms  QTm: ${$("e_qtm").value.trim()} ms  QTm(Bazett): ${$("e_qtc").value.trim()} ms  Eje: ${$("e_eje").value.trim()}  Transici√≥n: ${$("e_trans").value.trim()}  Posici√≥n: ${$("e_pos").value.trim()}  Hallazgos: ${$("e_find").value.trim()}`.replace(/\s+/g," ").trim();
  }

  function ecgNormal(){
    // Plantilla t√≠pica ‚Äúnormal‚Äù sugerida
    $("e_ritmo").value = "sinusal";
    $("e_fc").value = "80";
    $("e_p").value = "";
    $("e_pr").value = "";
    $("e_qrs").value = "";
    $("e_qtm").value = "";
    $("e_qtc").value = "";
    $("e_eje").value = "normal";
    $("e_trans").value = "";
    $("e_pos").value = "";
    $("e_find").value = "sin alteraciones agudas";
    $("incl_ecg").checked = false;
  }
  function ecgClear(){
    ["e_ritmo","e_fc","e_p","e_pr","e_qrs","e_qtm","e_qtc","e_eje","e_trans","e_pos","e_find"].forEach(id=>$(id).value="");
    $("incl_ecg").checked = false;
  }

  // ---------- CXR ----------
  function buildCXR(){
    const mode = $("cxr_mode").value;
    if(mode==="normal"){
      return `Radiograf√≠a de t√≥rax PA y lateral: Columna de aire central de apariencia permeable, recesos cardiofr√©nicos y costodiafragm√°ticos libres. Par√©nquima pulmonar sin alteraciones. Tejidos blandos y √≥seos sin alteraciones aparentes.`.replace(/\s+/g," ").trim();
    }
    const txt = $("cxr_custom").value.trim();
    return txt ? `Radiograf√≠a de t√≥rax PA y lateral: ${txt}`.replace(/\s+/g," ").trim()
               : "Radiograf√≠a de t√≥rax PA y lateral: (insertar hallazgos).";
  }

  function cxrNormal(){
    $("cxr_mode").value="normal";
    $("cxr_custom").value="";
    $("incl_cxr").checked = false;
  }
  function cxrClear(){ cxrNormal(); }

  // ---------- NOTA COMPLETA ----------
  function buildAll(){
    const core = buildCore();

    const chunks = [core];

    if($("incl_gas").checked){
      const g = buildGas();
      if(!g.endsWith("‚Äî")) chunks.push(g);
    }

    if($("incl_ecg").checked){
      const e = buildECG();
      if(!e.endsWith("‚Äî")) chunks.push(e);
    }

    if($("incl_cxr").checked){
      const r = buildCXR();
      chunks.push(r);
    }

    return chunks.join("\n\n").replace(/\n{3,}/g,"\n\n").trim();
  }

  // ---------- Render ----------
  function renderAll(){
    $("coreText").textContent = buildCore();
    $("gasText").textContent  = buildGas();
    $("ecgText").textContent  = buildECG();
    $("cxrText").textContent  = buildCXR();
    $("allText").textContent  = buildAll();
  }

  // Render on change/input
  document.addEventListener("input", (e)=>{ if(e.target.closest(".card")) renderAll(); });
  document.addEventListener("change",(e)=>{ if(e.target.closest(".card")) renderAll(); });

  // Copy buttons
  document.addEventListener("click", async (e)=>{
    const btn = e.target.closest("[data-copy]");
    if(!btn) return;
    const id = btn.getAttribute("data-copy");
    const el = $(id);
    if(el) await copyText(el.textContent || "");
  });

  // Buttons
  $("coreNormal").addEventListener("click", ()=>{coreNormal(); renderAll();});
  $("coreClear").addEventListener("click",  ()=>{coreClear(); renderAll();});
  $("gasNormal").addEventListener("click", ()=>{gasNormal(); renderAll();});
  $("gasClear").addEventListener("click",  ()=>{gasClear(); renderAll();});
  $("ecgNormal").addEventListener("click", ()=>{ecgNormal(); renderAll();});
  $("ecgClear").addEventListener("click",  ()=>{ecgClear(); renderAll();});
  $("cxrNormal").addEventListener("click", ()=>{cxrNormal(); renderAll();});
  $("cxrClear").addEventListener("click",  ()=>{cxrClear(); renderAll();});

  $("btnAllNormal").addEventListener("click", ()=>{
    coreNormal();
    gasNormal();
    ecgNormal();
    cxrNormal();
    renderAll();
    toast("Todo normal ‚úÖ");
  });

  $("btnAllClear").addEventListener("click", ()=>{
    coreClear();
    gasClear();
    ecgClear();
    cxrClear();
    $("incl_gas").checked = false;
    $("incl_ecg").checked = false;
    $("incl_cxr").checked = false;
    renderAll();
    toast("Limpio üßπ");
  });

  // Init
  coreNormal();
  gasNormal();
  ecgNormal();
  cxrNormal();
  renderAll();
</script>
</body>
</html>

